#### 实验记录

##### 环形传感器-直线追踪（1）：速度等分法

本次上传更新直线追踪代码，虽然采用的是环形传感器，但是只是用了正前方的那一个传感器做距离的采集，本次还做了电机的相关试验，包括电机的最大转速（1.7m/s），电机转一圈编码器计数为（390*4），一秒钟的计数额定为13000，实际试验以最大速度运行每10ms约为108-115，一秒钟也就是10800-11500，代码中按10000/s计算。

```
1.1： target=v_t*100.0/1.7;/理论上为130/1.7，线速度转换为编码器读数
```

target=v_t * 100 * 10000.0/1.7=v_t * 100.0/1.7；target为编码器10ms读数，* 100转换为1m读数，v_t为线速度。

本方法的追踪是通过如下方法：
测量与前方目标的距离，将距离分为若干等分，对每一等分的距离对应一个速度。具体表达式为

```
1.2： v_t=v_max*(array[1]-20.0)/(100.0-20.0);//设定线速度,40为允许最大距离，20为允许最小距离（可能为安全距离）
```

array[1]为与前方目标的距离，表达式实质就是将20-100cm的距离变成一个一个的速度，将算出的速度再通过式1.1转换为编码器的读数，最后在通过PID来达到目标读数。

对比采用传统的PID保持距离的算法（就是测距，然后与目标距离比较，从而控制电机转速的方法）好处是：

1：参数正定不会特别的复杂，传统的PID之所以难以调节是因为电机本身如果想运行就需要一个最低电压，这个最低电压在调节的时候可能就达不到，只有通过时间的累积误差才能越过最低电压，才能使小车调整位置，从而到时反应不够灵敏。而速度等分的方法只需要调节电机速度PID，而这个PID非常好调。

2：参数P直接导致距离过大时车速较快，在距离缩短至安全距离时因为反应过慢，导致追尾；这就需要参数D来抑制超调。而将速度等分的方法只需要调节一个参数就可以缓解这样的问题，就是式1.2中的100，该值越大，速度变化越不明显，可以有效避免追尾现象。

##### 固定方向追踪

设定小车线速度为0.5，根据轮椅与目标人物之间的偏航角，可计算左右车轮速度分别为 左轮速度=线速度+a，右轮速度=线速度-a，左右车轮的速度差2a=amax *（φnow-φtarget）/（φmax-φtarget），其中amax是设定的保证用户舒适感的左右车轮最大速度差，设为0.1，φmax是轮椅与目标人物之间允许的最大偏航角.之后将左右轮速度转化为编码器读数，输入到PID公式，即可控制小车朝固定方向进行偏转。































